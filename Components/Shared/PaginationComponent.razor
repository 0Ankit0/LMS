<div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
        <label for="pageSize" class="form-label me-2 mb-0">Show:</label>
        <select @onchange="HandlePageSizeChanged" class="form-select" style="width: auto;" id="pageSize">
            <option value="10" selected="@(PageSize == 10)">10</option>
            <option value="25" selected="@(PageSize == 25)">25</option>
            <option value="50" selected="@(PageSize == 50)">50</option>
            <option value="100" selected="@(PageSize == 100)">100</option>
        </select>
        <span class="ms-2 text-muted">
            Showing @StartItem to @EndItem of @TotalCount items
        </span>
    </div>

    @if (TotalPages > 1)
    {
        <nav aria-label="Table pagination">
            <ul class="pagination mb-0">
                <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                    <button @onclick="() => HandlePageChanged(1)" 
                            class="page-link" 
                            disabled="@(CurrentPage == 1)">
                        &laquo;&laquo;
                    </button>
                </li>
                <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                    <button @onclick="() => HandlePageChanged(CurrentPage - 1)" 
                            class="page-link" 
                            disabled="@(CurrentPage == 1)">
                        &laquo;
                    </button>
                </li>

                @foreach (var pageNumber in GetVisiblePages())
                {
                    <li class="page-item @(pageNumber == CurrentPage ? "active" : "")">
                        <button @onclick="() => HandlePageChanged(pageNumber)" class="page-link">
                            @pageNumber
                        </button>
                    </li>
                }

                <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                    <button @onclick="() => HandlePageChanged(CurrentPage + 1)" 
                            class="page-link" 
                            disabled="@(CurrentPage == TotalPages)">
                        &raquo;
                    </button>
                </li>
                <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                    <button @onclick="() => HandlePageChanged(TotalPages)" 
                            class="page-link" 
                            disabled="@(CurrentPage == TotalPages)">
                        &raquo;&raquo;
                    </button>
                </li>
            </ul>
        </nav>
    }
</div>

@code {
    [Parameter] public int CurrentPage { get; set; } = 1;
    [Parameter] public int PageSize { get; set; } = 10;
    [Parameter] public int TotalCount { get; set; }
    [Parameter] public int TotalPages { get; set; }
    [Parameter] public EventCallback<int> OnPageChanged { get; set; }
    [Parameter] public EventCallback<int> OnPageSizeChanged { get; set; }

    private int StartItem => TotalCount == 0 ? 0 : ((CurrentPage - 1) * PageSize) + 1;
    private int EndItem => Math.Min(CurrentPage * PageSize, TotalCount);

    private async Task HandlePageSizeChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var newSize))
        {
            await OnPageSizeChanged.InvokeAsync(newSize);
        }
    }

    private async Task HandlePageChanged(int page)
    {
        await OnPageChanged.InvokeAsync(page);
    }

    private IEnumerable<int> GetVisiblePages()
    {
        const int maxVisiblePages = 5;
        var half = maxVisiblePages / 2;
        var start = Math.Max(1, CurrentPage - half);
        var end = Math.Min(TotalPages, start + maxVisiblePages - 1);
        
        // Adjust start if we're near the end
        if (end - start + 1 < maxVisiblePages)
        {
            start = Math.Max(1, end - maxVisiblePages + 1);
        }

        return Enumerable.Range(start, end - start + 1);
    }
}
