@page "/Error"
@layout MainLayout
@using System.Diagnostics
@inject IWebHostEnvironment Environment

<PageTitle>Error - LMS</PageTitle>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-danger text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        An Error Occurred
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger mb-4">
                        <h5 class="alert-heading">We're sorry, something went wrong</h5>
                        <p class="mb-0">
                            An unexpected error occurred while processing your request.
                            Our technical team has been notified and is working to resolve the issue.
                        </p>
                    </div>

                    @if (ShowRequestId)
                    {
                        <div class="mb-3">
                            <strong>Request ID:</strong>
                            <code class="bg-light p-1 rounded">@RequestId</code>
                            <small class="text-muted d-block">
                                Please provide this ID when contacting support.
                            </small>
                        </div>
                    }

                    @if (Environment.IsDevelopment())
                    {
                        <div class="accordion mt-4" id="errorAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="developmentHeading">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#developmentContent" aria-expanded="false"
                                        aria-controls="developmentContent">
                                        <i class="bi bi-code-slash me-2"></i>
                                        Development Information
                                    </button>
                                </h2>
                                <div id="developmentContent" class="accordion-collapse collapse"
                                    aria-labelledby="developmentHeading" data-bs-parent="#errorAccordion">
                                    <div class="accordion-body">
                                        <div class="alert alert-warning">
                                            <strong>Development Mode Active:</strong>
                                            This detailed information is only shown in development environment.
                                            In production, users would see a generic error message for security reasons.
                                        </div>

                                        <h6>Environment Details:</h6>
                                        <ul class="list-unstyled">
                                            <li><strong>Environment:</strong> @Environment.EnvironmentName</li>
                                            <li><strong>Application:</strong> @Environment.ApplicationName</li>
                                            <li><strong>Timestamp:</strong> @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")
                                            </li>
                                        </ul>

                                        @if (!string.IsNullOrEmpty(RequestId))
                                        {
                                            <h6 class="mt-3">Request Information:</h6>
                                            <ul class="list-unstyled">
                                                <li><strong>Request ID:</strong> @RequestId</li>
                                                <li><strong>Activity ID:</strong> @(Activity.Current?.Id ?? "None")</li>
                                            </ul>
                                        }

                                        <div class="mt-3">
                                            <h6>Troubleshooting Tips:</h6>
                                            <ul>
                                                <li>Check the browser console for JavaScript errors</li>
                                                <li>Review the application logs for detailed error information</li>
                                                <li>Verify that all required services are running</li>
                                                <li>Check database connectivity if data-related operations are failing</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }

                    <div class="mt-4 d-flex gap-2 flex-wrap">
                        <a href="/" class="btn btn-primary">
                            <i class="bi bi-house me-2"></i>
                            Go to Home
                        </a>
                        <button onclick="history.back()" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>
                            Go Back
                        </button>
                        <button onclick="window.location.reload()" class="btn btn-outline-info">
                            <i class="bi bi-arrow-clockwise me-2"></i>
                            Reload Page
                        </button>
                        @if (ShowRequestId)
                        {
                            <button onclick="copyRequestId()" class="btn btn-outline-warning">
                                <i class="bi bi-clipboard me-2"></i>
                                Copy Request ID
                            </button>
                        }
                    </div>

                    <div class="mt-4 text-muted">
                        <small>
                            <i class="bi bi-clock me-1"></i>
                            Error occurred at @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function copyRequestId() {
        const requestId = '@RequestId';
        if (navigator.clipboard) {
            navigator.clipboard.writeText(requestId).then(() => {
                // You could show a toast notification here
                alert('Request ID copied to clipboard');
            }).catch(() => {
                // Fallback
                fallbackCopyText(requestId);
            });
        } else {
            fallbackCopyText(requestId);
        }
    }

    function fallbackCopyText(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('Request ID copied to clipboard');
    }
</script>

@code {
    [CascadingParameter]
    private HttpContext? HttpContext { get; set; }

    private string? RequestId { get; set; }
    private bool ShowRequestId => !string.IsNullOrEmpty(RequestId);

    protected override void OnInitialized() =>
    RequestId = Activity.Current?.Id ?? HttpContext?.TraceIdentifier;
}

                   
                