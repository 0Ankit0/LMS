@page "/admin"
@layout AdminLayout
@rendermode @(new InteractiveServerRenderMode(prerender: false))

<PageTitle>Admin Dashboard</PageTitle>

@if (isLoading)
{
    <MudGrid Class="mb-4">
        <MudItem xs="12">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="80px" />
        </MudItem>
    </MudGrid>

    <MudGrid>
        @for (int i = 0; i < 4; i++)
        {
            <MudItem lg="3" md="6" xs="12">
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="150px" />
            </MudItem>
        }
    </MudGrid>

    <MudGrid Class="mt-4">
        <MudItem lg="8" xs="12">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="350px" />
        </MudItem>
        <MudItem lg="4" xs="12">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="350px" />
        </MudItem>
    </MudGrid>

    <MudGrid Class="mt-4">
        <MudItem lg="6" xs="12">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="350px" />
        </MudItem>
        <MudItem lg="6" xs="12">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="350px" />
        </MudItem>
    </MudGrid>

    <MudGrid Class="mt-4">
        <MudItem md="6" xs="12">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="250px" />
        </MudItem>
        <MudItem md="6" xs="12">
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="250px" />
        </MudItem>
    </MudGrid>
}
else
{
    <MudGrid Class="mb-6">
        <MudItem xs="12">
            <MudStack Row Justify="Justify.SpaceBetween" Class="align-items-center">
                <MudStack>
                    <MudText Typo="Typo.h3" Class="mb-2 font-bold text-gray-900 dark:text-gray-100">Admin Dashboard</MudText>
                    <MudText Typo="Typo.body1" Class="text-gray-600 dark:text-gray-400">Welcome to the LMS Administration Panel</MudText>
                </MudStack>
                <MudStack>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/admin/analytics">
                        <MudIcon Icon="@Icons.Material.Filled.BarChart" Class="mr-2" />
                        View Detailed Analytics
                    </MudButton>
                </MudStack>
            </MudStack>
        </MudItem>
    </MudGrid>

    <MudGrid>
        <MudItem lg="3" md="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardContent>
                    <MudStack Row Justify="Justify.SpaceBetween" Class="align-items-center">
                        <MudStack>
                            <MudText Typo="Typo.h6" Class="text-gray-600 dark:text-gray-400 mb-1">Courses</MudText>
                            <MudText Typo="Typo.h3" Class="font-bold text-gray-900 dark:text-gray-100">@totalCourses</MudText>
                        </MudStack>
                        <MudIcon Icon="@Icons.Material.Filled.Book" Class="text-4xl text-gray-400 dark:text-gray-500" />
                    </MudStack>
                    <MudButton Variant="Variant.Text" Color="Color.Primary" Class="mt-3" Href="/admin/courses">Manage Courses</MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem lg="3" md="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardContent>
                    <MudStack Row Justify="Justify.SpaceBetween" Class="align-items-center">
                        <MudStack>
                            <MudText Typo="Typo.h6" Class="text-gray-600 dark:text-gray-400 mb-1">Categories</MudText>
                            <MudText Typo="Typo.h3" Class="font-bold text-gray-900 dark:text-gray-100">@totalCategories</MudText>
                        </MudStack>
                        <MudIcon Icon="@Icons.Material.Filled.Category" Class="text-4xl text-gray-400 dark:text-gray-500" />
                    </MudStack>
                    <MudButton Variant="Variant.Text" Color="Color.Primary" Class="mt-3" Href="/admin/categories">Manage Categories</MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem lg="3" md="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardContent>
                    <MudStack Row Justify="Justify.SpaceBetween" Class="align-items-center">
                        <MudStack>
                            <MudText Typo="Typo.h6" Class="text-gray-600 dark:text-gray-400 mb-1">Assessments</MudText>
                            <MudText Typo="Typo.h3" Class="font-bold text-gray-900 dark:text-gray-100">@totalAssessments</MudText>
                        </MudStack>
                        <MudIcon Icon="@Icons.Material.Filled.AssignmentTurnedIn" Class="text-4xl text-gray-400 dark:text-gray-500" />
                    </MudStack>
                    <MudButton Variant="Variant.Text" Color="Color.Primary" Class="mt-3" Href="/admin/assessments">Manage Assessments</MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem lg="3" md="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardContent>
                    <MudStack Row Justify="Justify.SpaceBetween" Class="align-items-center">
                        <MudStack>
                            <MudText Typo="Typo.h6" Class="text-gray-600 dark:text-gray-400 mb-1">Enrollments</MudText>
                            <MudText Typo="Typo.h3" Class="font-bold text-gray-900 dark:text-gray-100">@totalEnrollments</MudText>
                        </MudStack>
                        <MudIcon Icon="@Icons.Material.Filled.PersonAdd" Class="text-4xl text-gray-400 dark:text-gray-500" />
                    </MudStack>
                    <MudButton Variant="Variant.Text" Color="Color.Primary" Class="mt-3" Href="/admin/enrollments">Manage Enrollments</MudButton>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <!-- Charts Section -->
    <MudGrid Class="mt-6">
        <MudItem lg="8" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Course Enrollment Trends</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <!-- Placeholder for Line Chart -->
                    <MudPaper Class="h-72 flex items-center justify-center rounded-lg" Elevation="0" Style="background-color: var(--mud-palette-grey-light); height: 18rem;">
                        <MudText Typo="Typo.h6" Class="text-gray-500 dark:text-gray-400">Line Chart Placeholder</MudText>
                    </MudPaper>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem lg="4" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Course Categories</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <!-- Placeholder for Pie Chart -->
                    <MudPaper Class="h-72 flex items-center justify-center rounded-lg" Elevation="0" Style="background-color: var(--mud-palette-grey-light); height: 18rem;">
                        <MudText Typo="Typo.h6" Class="text-gray-500 dark:text-gray-400">Pie Chart Placeholder</MudText>
                    </MudPaper>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <MudGrid Class="mt-6">
        <MudItem lg="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Assessment Completion Rate</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <!-- Placeholder for Bar Chart -->
                    <MudPaper Class="h-72 flex items-center justify-center rounded-lg" Elevation="0" Style="background-color: var(--mud-palette-grey-light); height: 18rem;">
                        <MudText Typo="Typo.h6" Class="text-gray-500 dark:text-gray-400">Bar Chart Placeholder</MudText>
                    </MudPaper>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem lg="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Monthly Student Activity</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <!-- Placeholder for Doughnut Chart -->
                    <MudPaper Class="h-72 flex items-center justify-center rounded-lg" Elevation="0" Style="background-color: var(--mud-palette-grey-light); height: 18rem;">
                        <MudText Typo="Typo.h6" Class="text-gray-500 dark:text-gray-400">Doughnut Chart Placeholder</MudText>
                    </MudPaper>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <MudGrid Class="mt-6 mb-6">
        <MudItem xs="12">
            <MudCard Elevation="2" Class="card-modern">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Course Categories Performance Matrix</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <!-- Placeholder for Bar Chart -->
                    <MudPaper Class="h-80 flex items-center justify-center rounded-lg" Elevation="0" Style="background-color: var(--mud-palette-grey-light); height: 20rem;">
                        <MudText Typo="Typo.h6" Class="text-gray-500 dark:text-gray-400">Bar Chart Placeholder</MudText>
                    </MudPaper>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <!-- Recent Activity Table -->
    <MudGrid>
        <MudItem xs="12">
            <MudCard Elevation="2" Class="card-modern">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Recent Student Activity</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudTable T="StudentActivity" Items="@recentActivities" Hover="true" Breakpoint="Breakpoint.Sm">
                        <HeaderContent>
                            <MudTh>Student</MudTh>
                            <MudTh>Course</MudTh>
                            <MudTh>Activity</MudTh>
                            <MudTh>Progress</MudTh>
                            <MudTh>Last Active</MudTh>
                            <MudTh>Status</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Student">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <MudAvatar Color="Color.Primary" Variant="Variant.Filled">
                                        <MudText Typo="Typo.h6">@context.StudentName.Substring(0, 1)</MudText>
                                    </MudAvatar>
                                    <MudText>@context.StudentName</MudText>
                                </div>
                            </MudTd>
                            <MudTd DataLabel="Course">@context.CourseName</MudTd>
                            <MudTd DataLabel="Activity">@context.Activity</MudTd>
                            <MudTd DataLabel="Progress">
                                <MudProgressLinear Value="@((double)context.Progress)" Color="Color.Primary" Class="my-2" Style="height: 6px;" />
                                <MudText Typo="Typo.caption" Class="text-gray-500 dark:text-gray-400">@context.Progress%</MudText>
                            </MudTd>
                            <MudTd DataLabel="Last Active">@context.LastActive.ToString("MMM dd, HH:mm")</MudTd>
                            <MudTd DataLabel="Status">
                                <MudChip T="string" Color="@GetStatusBadgeColor(context.Status)">@context.Status</MudChip>
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>

    <MudGrid Class="mt-6">
        <MudItem md="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Quick Actions</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudList T="string" Clickable="true">
                        <MudListItem T="string" Href="/admin/courses/create" Icon="@Icons.Material.Filled.AddCircle">Create New Course</MudListItem>
                        <MudListItem T="string" Href="/admin/categories/create" Icon="@Icons.Material.Filled.AddCircle">Create New Category</MudListItem>
                        <MudListItem T="string" Href="/admin/assessments/create" Icon="@Icons.Material.Filled.AddCircle">Create New Assessment</MudListItem>
                        <MudListItem T="string" Href="/admin/achievements/create" Icon="@Icons.Material.Filled.AddCircle">Create New Achievement</MudListItem>
                    </MudList>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <MudItem md="6" xs="12">
            <MudCard Elevation="2" Class="card-modern h-full">
                <MudCardHeader>
                    <MudText Typo="Typo.h6" Class="font-semibold text-gray-900 dark:text-gray-100">Management Tools</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudList T="string" Clickable="true">
                        <MudListItem T="string" Href="/admin/modules" Icon="@Icons.Material.Filled.Folder">Manage Modules</MudListItem>
                        <MudListItem T="string" Href="/admin/lessons" Icon="@Icons.Material.Filled.PlayCircle">Manage Lessons</MudListItem>
                        <MudListItem T="string" Href="/admin/forums" Icon="@Icons.Material.Filled.Forum">Manage Forums</MudListItem>
                        <MudListItem T="string" Href="/admin/certificates" Icon="@Icons.Material.Filled.EmojiEvents">Manage Certificates</MudListItem>
                    </MudList>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
}

@code {
    private bool isLoading = true;
    private int totalCourses = 0;
    private int totalCategories = 0;
    private int totalAssessments = 0;
    private int totalEnrollments = 0;
    private List<StudentActivity> recentActivities = new();

    protected override async Task OnInitializedAsync()
    {
        // Simulate loading
        await Task.Delay(500);
        // Real data implementation to be added
        totalCourses = 12;
        totalCategories = 5;
        totalAssessments = 34;
        totalEnrollments = 120;
        recentActivities = new List<StudentActivity>
        {
            new StudentActivity { StudentName = "Alice Johnson", CourseName = "Intro to Programming", Activity = "Completed Quiz", Progress = 85, LastActive = DateTime.Now.AddHours(-2), Status = "Completed" },
            new StudentActivity { StudentName = "Bob Smith", CourseName = "Business 101", Activity = "Viewed Lesson", Progress = 40, LastActive = DateTime.Now.AddHours(-5), Status = "Active" },
            new StudentActivity { StudentName = "Carol Lee", CourseName = "Design Basics", Activity = "Submitted Assignment", Progress = 100, LastActive = DateTime.Now.AddHours(-1), Status = "Completed" },
            new StudentActivity { StudentName = "David Kim", CourseName = "Web Development", Activity = "Started Course", Progress = 10, LastActive = DateTime.Now.AddHours(-10), Status = "Active" }
        };
        isLoading = false;
    }

    public class StudentActivity
    {
        public string StudentName { get; set; } = string.Empty;
        public string CourseName { get; set; } = string.Empty;
        public string Activity { get; set; } = string.Empty;
        public int Progress { get; set; }
        public DateTime LastActive { get; set; }
        public string Status { get; set; } = string.Empty;
    }

    private Color GetStatusBadgeColor(string status)
    {
        return status.ToLower() switch
        {
            "completed" => Color.Success,
            "active" => Color.Primary,
            "pending" => Color.Warning,
            "failed" => Color.Error,
            _ => Color.Secondary
        };
    }
}


