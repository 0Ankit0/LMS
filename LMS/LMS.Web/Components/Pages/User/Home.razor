@page "/home"
@page "/"

@layout LMS.Web.Components.Pages.User.Shared.SharedPagesLayout
@inject NavigationManager NavigationManager
@inject UserManager<User> UserManager
@inject AuthenticationStateProvider AuthenticationStateProvider
@using LMS.Data.Entities
@using LMS.Web.Components.Account
@rendermode InteractiveServer
<PageTitle>Home</PageTitle>

@if (isLoading)
{
    <MudContainer MaxWidth="MaxWidth.Large" Class="mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <MudGrid GutterSize="32">
            <MudItem xs="12" lg="3">
                @for (int i = 0; i < 3; i++)
                {
                    <MudSkeleton Height="120px" Class="mb-4 rounded-lg" />
                }
            </MudItem>
            <MudItem xs="12" lg="5">
                <MudSkeleton Height="60px" Class="mb-4 rounded-lg" />
                <MudSkeleton Height="200px" Class="mb-4 rounded-lg" />
                <MudSkeleton Height="200px" Class="mb-4 rounded-lg" />
            </MudItem>
            <MudItem xs="12" lg="4">
                <MudSkeleton Height="60px" Class="mb-4 rounded-lg" />
                <MudSkeleton Height="200px" Class="mb-4 rounded-lg" />
                <MudSkeleton Height="200px" Class="mb-4 rounded-lg" />
            </MudItem>
        </MudGrid>
    </MudContainer>
}
else
{
    <MudContainer MaxWidth="MaxWidth.Large" Class="mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <MudGrid GutterSize="32">
            <!-- Left Section - Quick Navigation -->
            <MudItem xs="12" lg="3">
                <MudStack Spacing="2">
                    <MudCard Class="mb-2 cursor-pointer hover:shadow-md transition-shadow">
                        <MudCardContent Class="p-4">
                            <MudLink Href="/user/lms/dashboard" Class="flex items-center gap-3">
                                <MudIcon Icon="@Icons.Material.Filled.Dashboard" Color="Color.Primary" />
                                <MudText>Dashboard</MudText>
                            </MudLink>
                        </MudCardContent>
                    </MudCard>
                    <MudCard Class="mb-2 cursor-pointer hover:shadow-md transition-shadow">
                        <MudCardContent Class="p-4">
                            <MudLink Href="/user/lms/forums" Class="flex items-center gap-3">
                                <MudIcon Icon="@Icons.Material.Filled.Forum" Color="Color.Secondary" />
                                <MudText>Forums</MudText>
                            </MudLink>
                        </MudCardContent>
                    </MudCard>
                    <MudCard Class="mb-2 cursor-pointer hover:shadow-md transition-shadow">
                        <MudCardContent Class="p-4">
                            <MudLink Href="/user/lms/analytics" Class="flex items-center gap-3">
                                <MudIcon Icon="@Icons.Material.Filled.Analytics" Color="Color.Info" />
                                <MudText>Analytics</MudText>
                            </MudLink>
                        </MudCardContent>
                    </MudCard>
                    <MudCard Class="mb-2 cursor-pointer hover:shadow-md transition-shadow">
                        <MudCardContent Class="p-4">
                            <MudLink Href="/user/lms/my-courses" Class="flex items-center gap-3">
                                <MudIcon Icon="@Icons.Material.Filled.School" Color="Color.Success" />
                                <MudText>My Courses</MudText>
                            </MudLink>
                        </MudCardContent>
                    </MudCard>
                </MudStack>
            </MudItem>
            <!-- Middle Section - Announcements -->
            <MudItem xs="12" lg="5">
                <MudStack Spacing="2">
                    <MudStack Row="true" AlignItems="AlignItems.End" JustifyContent="SpaceBetween">
                        <MudText Typo="Typo.h6">Announcements</MudText>
                        <MudBadge Color="Color.Info" Variant="Variant.Filled" Class="mr-2">New</MudBadge>
                        <MudButton Ripple="true" Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small"
                            Href="/user/lms/announcement-list">View All</MudButton>
                    </MudStack>
                    <MudPaper Class="max-h-96 overflow-y-auto p-2">
                        <Announcements />
                    </MudPaper>
                </MudStack>
            </MudItem>
            <!-- Right Section - Course List -->
            <MudItem xs="12" lg="4">
                <MudStack Spacing="2">
                    <MudStack Direction="Row" AlignItems="AlignItems.Center" JustifyContent="SpaceBetween">
                        <MudText Typo="Typo.h6">My Courses</MudText>
                        <MudBadge Color="Color.Success" Variant="Variant.Filled">Enrolled</MudBadge>
                    </MudStack>
                    <MudPaper Class="max-h-96 overflow-y-auto p-2">
                        <CourseListSearch User="currentUser" />
                    </MudPaper>
                </MudStack>
            </MudItem>
        </MudGrid>
    </MudContainer>
}

@code {
    private bool isLoading = true;
    private UserModel? currentUser;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = await UserManager.GetUserAsync(authState.User);
        if (user is not null)
        {
            var userName = user.UserName ?? string.Empty;
            currentUser = new UserModel { UserName = userName };
        }
        isLoading = false;
    }
}